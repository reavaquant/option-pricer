\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath, amssymb}
\usepackage{geometry}
\geometry{margin=2.5cm}

\title{Black--Scholes Monte Carlo Pricer}
\author{Option Pricer Project}
\date{\today}

\begin{document}
\maketitle

\section{Goal}
Estimate the price of options (vanilla, digital, Asian) under Black--Scholes via Monte Carlo, provide a confidence interval, and avoid storing all paths to keep memory low.

\section{Model}
Underlying follows a geometric Brownian motion
\[
\mathrm{d}S_t = r S_t\,\mathrm{d}t + \sigma S_t\,\mathrm{d}W_t,
\quad
S_{t_{k+1}} = S_{t_k}\exp\!\big((r-\tfrac12\sigma^2)\Delta t + \sigma \sqrt{\Delta t}\,Z_k\big),\; Z_k\sim\mathcal N(0,1).
\]
The time grid $\{t_k\}$ comes directly from the option (full path for an Asian).

\section{Simulation algorithm}
\begin{itemize}
  \item Precompute per-step terms $(r - \tfrac12\sigma^2)\Delta t_k$ and $\sigma\sqrt{\Delta t_k}$; reject non-increasing time steps.
  \item Antithetic variates: for each Gaussian draw $Z$, simulate two paths $S^+$ and $S^-$ using $Z$ and $-Z$ (variance reduction at no extra cost).
  \item Path construction: start both paths at $S_0$, iterate over steps applying the exponential update and store $S^+$, $S^-$ in reusable vectors.
  \item Payoff: evaluate \texttt{option\_->payoffPath(path)} on each completed path, then discount by $\exp(-rT)$.
  \item Online stats: update the running mean and $M2$ (Welford) with each discounted payoff; no need to retain past payoffs.
\end{itemize}

\section{Mean and variance estimator}
Online Welford updates:
\[
\hat{P}_{n} = \hat{P}_{n-1} + \frac{X_n - \hat{P}_{n-1}}{n},
\quad
M2_n = M2_{n-1} + (X_n - \hat{P}_{n-1})(X_n - \hat{P}_n).
\]
Estimated variance: $\hat{\sigma}^2 = M2_n/(n-1)$, standard error $\hat{\sigma}/\sqrt{n}$.

\section{Confidence interval}
\[
\text{CI}_{95\%} = \hat{P}_n \pm 1.96 \times \frac{\hat{\sigma}}{\sqrt{n}},
\]
available via \texttt{confidenceInterval()} after at least two paths.

\section{Key implementation points (\texttt{generate})}
\begin{itemize}
  \item Inputs: number of paths $N$; if $N\le 0$ the call is ignored.
  \item Uses two reusable vectors (\texttt{path\_pos}, \texttt{path\_neg}) sized to the time grid.
  \item For each Gaussian $Z$: update $S^+$ and $S^-$ across all steps, then:
    \begin{itemize}
      \item compute discounted payoff of $S^+$, increment \texttt{nb\_paths\_}, update mean and $M2$;
      \item if more paths remain, do the same with $S^-$ (antithetic) and increment counters.
    \end{itemize}
  \item Discount factor is $\exp(-rT)$ with $T$ the last time step; \texttt{nb\_paths\_}, \texttt{estimate\_}, and \texttt{M2\_} track the current simulation state.
  \item \texttt{price()} throws if no paths were generated; \texttt{confidenceInterval()} throws if fewer than two paths are available.
\end{itemize}

\end{document}
